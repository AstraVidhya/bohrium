sudo: false
language: c
compiler:
  - gcc
  - clang
env:
   - BH_STACK="stack_gpu" BH_GPU_VERBOSE=true LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH" BH_EXCLUDE="--exclude-test test_gauss  --exclude-test test_gauss_20x20 --exclude-test test_jacobi --exclude-test test_jacobi_fixed --exclude-test test_idl_init"
   - BH_STACK="stack_gpu" BH_GPU_VERBOSE=true BH_GPU_COMPILE=sync LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - BH_STACK="stack_gpu" BH_FUSE_MODEL=NO_XSWEEP_SCALAR_SEPERATE BH_GPU_VERBOSE=true LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH" BH_EXCLUDE="--exclude-test test_gauss  --exclude-test test_gauss_20x20 --exclude-test test_jacobi --exclude-test test_jacobi_fixed --exclude-test test_idl_init"
   - BH_STACK="stack_gpu" BH_FUSE_MODEL=NO_XSWEEP_SCALAR_SEPERATE BH_GPU_VERBOSE=true BH_GPU_COMPILE=sync LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=3 BH_BCEXP_SIGN=1 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=3 BH_BCEXP_SIGN=0 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=1 BH_BCEXP_SIGN=1 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=1 BH_BCEXP_SIGN=0 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - BH_STACK="stack_cpu_greedy" OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=3 BH_BCEXP_SIGN=1 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - BH_STACK="stack_cpu_greedy" OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=3 BH_BCEXP_SIGN=0 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - BH_STACK="stack_cpu_greedy" OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=1 BH_BCEXP_SIGN=1 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
   - BH_STACK="stack_cpu_greedy" OMP_NUM_THREADS=4 BH_CPU_JIT_LEVEL=1 BH_BCEXP_SIGN=0 LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
before_install:
  - apt-get -s build-dep python-numpy
addons:
  apt:
   packages:
   - cmake
   - cython
   - docutils-common
   - fglrx
   - fglrx-dev
   - freeglut3
   - freeglut3-dev
   - gfortran
   - gfortran-4.6
   - libblas-dev
   - libboost-all-dev
   - libboost-dev
   - libboost-filesystem-dev
   - libboost-serialization-dev
   - libboost-system-dev
   - libboost-thread-dev
   - libhwloc-dev
   - libjs-sphinxdoc
   - libjs-underscore
   - liblapack-dev
   - libpython3.2
   - libxi-dev
   - libxmu-dev
   - opencl-headers
   - patchutils
   - python
   - python-all
   - python-all-dbg
   - python-all-dev
   - python-cheetah
   - python-dbg
   - python-docutils
   - python-jinja2
   - python-markupsafe
   - python-nose
   - python-numpy
   - python-pygments
   - python-roman
   - python-sphinx
   - python2.7-dbg
   - python3
   - python3-all
   - python3-all-dbg
   - python3-all-dev
   - python3-dbg
   - python3-dev
   - python3-minimal
   - python3-nose
   - python3-pkg-resources
   - python3.2
   - python3.2-dbg
   - python3.2-dev
   - python3.2-minimal
   - sphinx-common
   - swig
script:
  - df -h
  - mkdir bdir && cd bdir && cmake -DCMAKE_BUILD_TYPE=Release .. && make -j4 && make install
  - BASEDIR=${HOME}/build/bh107 && git clone --depth=1 git://github.com/bh107/benchpress.git ${BASEDIR}/benchpress && cd ${BASEDIR}/benchpress && . util/setbpenv.bash && cd ${BASEDIR}
  - python bohrium/test/python/numpytest.py $BH_EXCLUDE
  - df -h
  - du -h ${HOME}/.local/var
